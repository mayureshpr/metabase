databaseChangeLog:
  # The quoting strategy decides when things like column names should be quoted. This is in place to deal with
  # Liquibase not knowing about all of the new reserved words in MySQL 8+. Using a column name that is a reserved word
  # causes a failure. Quoting all objects breaks H2 support though as it will quote table names but not quote that
  # same table name in a foreign key reference which will cause a failure when trying to initially setup the database.
  - property:
      name: quote_strategy
      value: QUOTE_ALL_OBJECTS
      dbms: mysql,mariadb
  - property:
      name: quote_strategy
      value: LEGACY
      dbms: postgresql,h2
  - property:
      name: timestamp_type
      value: timestamp with time zone
      dbms: postgresql,h2
  - property:
      name: timestamp_type
      value: timestamp(6)
      dbms: mysql,mariadb
  # In MySQL, use LONGTEXT instead of TEXT (#7006)
  - property:
      name: text.type
      value: text
      dbms: postgresql,h2
  - property:
      name: text.type
      value: longtext
      dbms: mysql,mariadb

  - changeSet:
      id: '1'
      author: agilliland
      objectQuotingStrategy: ${quote_strategy}
      changes:
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
                unique: true
              name: slug
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: description
              type: text
          - column:
              name: logo_url
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: inherits
              type: boolean
          tableName: core_organization
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
                unique: true
              name: email
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: first_name
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: last_name
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: password
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              defaultValue: default
              name: password_salt
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: date_joined
              type: DATETIME
          - column:
              constraints:
                nullable: true
              name: last_login
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: is_staff
              type: boolean
          - column:
              constraints:
                nullable: false
              name: is_superuser
              type: boolean
          - column:
              constraints:
                nullable: false
              name: is_active
              type: boolean
          - column:
              name: reset_token
              type: varchar(254)
          - column:
              name: reset_triggered
              type: BIGINT
          tableName: core_user
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: admin
              type: boolean
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_userorgperm_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: user_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_userorgperm_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          tableName: core_userorgperm
      - addUniqueConstraint:
          columnNames: user_id, organization_id
          constraintName: idx_unique_user_id_organization_id
          tableName: core_userorgperm
      - createIndex:
          columns:
          - column:
              name: user_id
              type: int
          indexName: idx_userorgperm_user_id
          tableName: core_userorgperm
      - createIndex:
          columns:
          - column:
              name: organization_id
              type: int
          indexName: idx_userorgperm_organization_id
          tableName: core_userorgperm
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: url
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: timestamp
              type: DATETIME
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_permissionviolation_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: user_id
              type: int
          tableName: core_permissionsviolation
      - createIndex:
          columns:
          - column:
              name: user_id
              type: int
          indexName: idx_permissionsviolation_user_id
          tableName: core_permissionsviolation
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: description
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_database_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          - column:
              name: details
              type: text
          - column:
              constraints:
                nullable: false
              name: engine
              type: varchar(254)
          tableName: metabase_database
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_database_organization_id
          tableName: metabase_database
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: rows
              type: int
          - column:
              name: description
              type: text
          - column:
              name: entity_name
              type: varchar(254)
          - column:
              name: entity_type
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: active
              type: boolean
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_table_ref_database_id
                initiallyDeferred: false
                nullable: false
                references: metabase_database(id)
              name: db_id
              type: int
          tableName: metabase_table
      - createIndex:
          columns:
          - column:
              name: db_id
          indexName: idx_table_db_id
          tableName: metabase_table
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: base_type
              type: varchar(255)
          - column:
              name: special_type
              type: varchar(255)
          - column:
              constraints:
                nullable: false
              name: active
              type: boolean
          - column:
              name: description
              type: text
          - column:
              constraints:
                nullable: false
              name: preview_display
              type: boolean
          - column:
              constraints:
                nullable: false
              name: position
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_field_ref_table_id
                initiallyDeferred: false
                nullable: false
                references: metabase_table(id)
              name: table_id
              type: int
          - column:
              constraints:
                nullable: false
              name: field_type
              type: varchar(254)
          tableName: metabase_field
      - createIndex:
          columns:
          - column:
              name: table_id
          indexName: idx_field_table_id
          tableName: metabase_field
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: relationship
              type: varchar(254)
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_foreignkey_dest_ref_field_id
                initiallyDeferred: false
                nullable: false
                references: metabase_field(id)
              name: destination_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_foreignkey_origin_ref_field_id
                initiallyDeferred: false
                nullable: false
                references: metabase_field(id)
              name: origin_id
              type: int
          tableName: metabase_foreignkey
      - createIndex:
          columns:
          - column:
              name: destination_id
          indexName: idx_foreignkey_destination_id
          tableName: metabase_foreignkey
      - createIndex:
          columns:
          - column:
              name: origin_id
          indexName: idx_foreignkey_origin_id
          tableName: metabase_foreignkey
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              name: values
              type: text
          - column:
              name: human_readable_values
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_fieldvalues_ref_field_id
                initiallyDeferred: false
                nullable: false
                references: metabase_field(id)
              name: field_id
              type: int
          tableName: metabase_fieldvalues
      - createIndex:
          columns:
          - column:
              name: field_id
          indexName: idx_fieldvalues_field_id
          tableName: metabase_fieldvalues
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_tablesegment_ref_table_id
                initiallyDeferred: false
                nullable: false
                references: metabase_table(id)
              name: table_id
              type: int
          - column:
              constraints:
                nullable: false
              name: filter_clause
              type: text
          tableName: metabase_tablesegment
      - createIndex:
          columns:
          - column:
              name: table_id
          indexName: idx_tablesegment_table_id
          tableName: metabase_tablesegment
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: type
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: details
              type: text
          - column:
              constraints:
                nullable: false
              name: version
              type: int
          - column:
              constraints:
                nullable: false
              name: public_perms
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_query_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: creator_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_query_ref_database_id
                initiallyDeferred: false
                nullable: false
                references: metabase_database(id)
              name: database_id
              type: int
          tableName: query_query
      - createIndex:
          columns:
          - column:
              name: creator_id
          indexName: idx_query_creator_id
          tableName: query_query
      - createIndex:
          columns:
          - column:
              name: database_id
          indexName: idx_query_database_id
          tableName: query_query
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
                unique: true
              name: uuid
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: version
              type: int
          - column:
              constraints:
                nullable: false
              name: json_query
              type: text
          - column:
              constraints:
                nullable: false
              name: raw_query
              type: text
          - column:
              constraints:
                nullable: false
              name: status
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: started_at
              type: DATETIME
          - column:
              name: finished_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: running_time
              type: int
          - column:
              constraints:
                nullable: false
              name: error
              type: text
          - column:
              constraints:
                nullable: false
              name: result_file
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: result_rows
              type: int
          - column:
              constraints:
                nullable: false
              name: result_data
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_queryexecution_ref_query_id
                initiallyDeferred: false
                nullable: true
                references: query_query(id)
              name: query_id
              type: int
          - column:
              constraints:
                nullable: false
              name: additional_info
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_queryexecution_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: executor_id
              type: int
          tableName: query_queryexecution
      - createIndex:
          columns:
          - column:
              name: query_id
          indexName: idx_queryexecution_query_id
          tableName: query_queryexecution
      - createIndex:
          columns:
          - column:
              name: executor_id
          indexName: idx_queryexecution_executor_id
          tableName: query_queryexecution
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: description
              type: text
          - column:
              constraints:
                nullable: false
              name: display
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: public_perms
              type: int
          - column:
              constraints:
                nullable: false
              name: dataset_query
              type: text
          - column:
              constraints:
                nullable: false
              name: visualization_settings
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_card_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: creator_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_card_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          tableName: report_card
      - createIndex:
          columns:
          - column:
              name: creator_id
          indexName: idx_card_creator_id
          tableName: report_card
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_card_organization_id
          tableName: report_card
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_cardfavorite_ref_card_id
                initiallyDeferred: false
                nullable: false
                references: report_card(id)
              name: card_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_cardfavorite_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: owner_id
              type: int
          tableName: report_cardfavorite
      - addUniqueConstraint:
          columnNames: card_id, owner_id
          constraintName: idx_unique_cardfavorite_card_id_owner_id
          tableName: report_cardfavorite
      - createIndex:
          columns:
          - column:
              name: card_id
          indexName: idx_cardfavorite_card_id
          tableName: report_cardfavorite
      - createIndex:
          columns:
          - column:
              name: owner_id
          indexName: idx_cardfavorite_owner_id
          tableName: report_cardfavorite
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: description
              type: text
          - column:
              constraints:
                nullable: false
              name: public_perms
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboard_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: creator_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboard_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          tableName: report_dashboard
      - createIndex:
          columns:
          - column:
              name: creator_id
          indexName: idx_dashboard_creator_id
          tableName: report_dashboard
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_dashboard_organization_id
          tableName: report_dashboard
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: sizeX
              type: int
          - column:
              constraints:
                nullable: false
              name: sizeY
              type: int
          - column:
              name: row
              type: int
          - column:
              name: col
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboardcard_ref_card_id
                initiallyDeferred: false
                nullable: false
                references: report_card(id)
              name: card_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboardcard_ref_dashboard_id
                initiallyDeferred: false
                nullable: false
                references: report_dashboard(id)
              name: dashboard_id
              type: int
          tableName: report_dashboardcard
      - createIndex:
          columns:
          - column:
              name: card_id
          indexName: idx_dashboardcard_card_id
          tableName: report_dashboardcard
      - createIndex:
          columns:
          - column:
              name: dashboard_id
          indexName: idx_dashboardcard_dashboard_id
          tableName: report_dashboardcard
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboardsubscription_ref_dashboard_id
                initiallyDeferred: false
                nullable: false
                references: report_dashboard(id)
              name: dashboard_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_dashboardsubscription_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: user_id
              type: int
          tableName: report_dashboardsubscription
      - addUniqueConstraint:
          columnNames: dashboard_id, user_id
          constraintName: idx_uniq_dashsubscrip_dashboard_id_user_id
          tableName: report_dashboardsubscription
      - createIndex:
          columns:
          - column:
              name: dashboard_id
          indexName: idx_dashboardsubscription_dashboard_id
          tableName: report_dashboardsubscription
      - createIndex:
          columns:
          - column:
              name: user_id
          indexName: idx_dashboardsubscription_user_id
          tableName: report_dashboardsubscription
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: name
              type: varchar(254)
          - column:
              name: description
              type: text
          - column:
              constraints:
                nullable: false
              name: public_perms
              type: int
          - column:
              constraints:
                nullable: false
              name: mode
              type: int
          - column:
              constraints:
                nullable: false
              name: version
              type: int
          - column:
              constraints:
                nullable: false
              name: dataset_query
              type: text
          - column:
              name: email_addresses
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreport_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: creator_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreport_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          - column:
              constraints:
                nullable: false
              name: schedule
              type: text
          tableName: report_emailreport
      - createIndex:
          columns:
          - column:
              name: creator_id
          indexName: idx_emailreport_creator_id
          tableName: report_emailreport
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_emailreport_organization_id
          tableName: report_emailreport
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreport_recipients_ref_emailreport_id
                initiallyDeferred: false
                nullable: false
                references: report_emailreport(id)
              name: emailreport_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreport_recipients_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: user_id
              type: int
          tableName: report_emailreport_recipients
      - addUniqueConstraint:
          columnNames: emailreport_id, user_id
          constraintName: idx_uniq_emailreportrecip_emailreport_id_user_id
          tableName: report_emailreport_recipients
      - createIndex:
          columns:
          - column:
              name: emailreport_id
          indexName: idx_emailreport_recipients_emailreport_id
          tableName: report_emailreport_recipients
      - createIndex:
          columns:
          - column:
              name: user_id
          indexName: idx_emailreport_recipients_user_id
          tableName: report_emailreport_recipients
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: details
              type: text
          - column:
              constraints:
                nullable: false
              name: status
              type: varchar(254)
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              name: started_at
              type: DATETIME
          - column:
              name: finished_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: error
              type: text
          - column:
              constraints:
                nullable: false
              name: sent_email
              type: text
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreportexecutions_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_emailreportexecutions_ref_report_id
                initiallyDeferred: false
                nullable: true
                references: report_emailreport(id)
              name: report_id
              type: int
          tableName: report_emailreportexecutions
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_emailreportexecutions_organization_id
          tableName: report_emailreportexecutions
      - createIndex:
          columns:
          - column:
              name: report_id
          indexName: idx_emailreportexecutions_report_id
          tableName: report_emailreportexecutions
      - createTable:
          columns:
          - column:
              autoIncrement: true
              constraints:
                nullable: false
                primaryKey: true
              name: id
              type: int
          - column:
              constraints:
                nullable: false
              name: created_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: updated_at
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: start
              type: DATETIME
          - column:
              constraints:
                nullable: false
              name: end
              type: DATETIME
          - column:
              name: title
              type: TEXT
          - column:
              constraints:
                nullable: false
              name: body
              type: TEXT
          - column:
              constraints:
                nullable: false
              name: annotation_type
              type: int
          - column:
              constraints:
                nullable: false
              name: edit_count
              type: int
          - column:
              constraints:
                nullable: false
              name: object_type_id
              type: int
          - column:
              constraints:
                nullable: false
              name: object_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_annotation_ref_user_id
                initiallyDeferred: false
                nullable: false
                references: core_user(id)
              name: author_id
              type: int
          - column:
              constraints:
                deferrable: false
                foreignKeyName: fk_annotation_ref_organization_id
                initiallyDeferred: false
                nullable: false
                references: core_organization(id)
              name: organization_id
              type: int
          tableName: annotation_annotation
      - createIndex:
          columns:
          - column:
              name: author_id
          indexName: idx_annotation_author_id
          tableName: annotation_annotation
      - createIndex:
          columns:
          - column:
              name: organization_id
          indexName: idx_annotation_organization_id
          tableName: annotation_annotation
      - createIndex:
          columns:
          - column:
              name: object_type_id
          indexName: idx_annotation_object_type_id
          tableName: annotation_annotation
      - createIndex:
          columns:
          - column:
              name: object_id
          indexName: idx_annotation_object_id
          tableName: annotation_annotation
      - modifySql:
          dbms: postgresql
          replace:
            replace: WITHOUT
            with: WITH


# >>>>>>>>>> DO NOT ADD NEW MIGRATIONS BELOW THIS LINE! ADD THEM ABOVE <<<<<<<<<<

########################################################################################################################
#
# ADVICE:
#
# 1) Run ./bin/lint-migrations-file.sh to run core.spec checks against any changes you make here. Liquibase is pretty
#    forgiving and won't complain if you accidentally mix up things like deleteCascade and onDelete: CASCADE. CI runs
#    this check but it's nicer to know now instead of waiting for CI.
#
# 2) Please post a message in the Metabase Slack #migrations channel to let others know you are creating a new
#    migration so someone else doesn't steal your ID number
#
# 3) Migrations IDs should follow the format
#
#    vMM.mm-NNN
#
#    where
#
#    M = major version
#    m = minor version
#    N = migration number relative to that major+minor version
#
#   e.g. the first migration added to 0.42.0 should be numbered v42.00-000 and the second migration should be numbered
#   v42.00-001. The first migration for 0.42.1 should be numbered v42.01-000, and so forth.
#
#   This numbering scheme was adopted beginning with version 0.42.0 so that we could go back and add migrations to patch
#   releases without the ID sequence getting wildly out of order. See PR #18821 for more information.
#
# 3) Migrations IDs should follow the format
#
#    vMM.mm-NNN
#
#    where
#
#    M = major version
#    m = minor version
#    N = migration number relative to that major+minor version
#
#   e.g. the first migration added to 0.42.0 should be numbered v42.00-000 and the second migration should be numbered
#   v42.00-001. The first migration for 0.42.1 should be numbered v42.01-000, and so forth.
#
#   This numbering scheme was adopted beginning with version 0.42.0 so that we could go back and add migrations to patch
#   releases without the ID sequence getting wildly out of order. See PR #18821 for more information.
#
# PLEASE KEEP THIS MESSAGE AT THE BOTTOM OF THIS FILE!!!!! Add new migrations above the message.
#
########################################################################################################################
